---
title: GitLab
description: Используйте blackbox ai в задачах GitLab и мерж-реквестах.
---

blackbox ai интегрируется с вашим рабочим процессом GitLab через конвейер GitLab CI/CD или с GitLab Duo.

В обоих случаях blackbox ai будет работать на ваших программах GitLab.

---

## GitLab

blackbox ai работает в обычном конвейере GitLab. Вы можете встроить его в конвейер как [CI-компонент](https://docs.gitlab.com/ee/ci/components/)

Здесь мы используем созданный сообществом компонент CI/CD для blackbox ai — [nagyv/gitlab-blackbox ai](https://gitlab.com/nagyv/gitlab-blackbox ai).

---

### Функции

- **Использовать пользовательскую конфигурацию для каждого задания**. Настройте blackbox ai с помощью пользовательского каталога конфигурации, например `./config/#custom-directory`, чтобы включать или отключать функциональность для каждого вызова blackbox ai.
- **Минимальная настройка**: компонент CI настраивает blackbox ai в фоновом режиме, вам нужно только создать конфигурацию blackbox ai и начальное приглашение.
- **Гибкость**: компонент CI поддерживает несколько входных данных для настройки его поведения.

---

### Настройка

1. Сохраните JSON аутентификации blackbox ai как переменные среды CI типа файла в разделе **Настройки** > **CI/CD** > **Переменные**. Обязательно пометьте их как «Замаскированные и скрытые».
2. Добавьте следующее в файл `.gitlab-ci.yml`.

   ```yaml title=".gitlab-ci.yml"
   include:
     - component: $CI_SERVER_FQDN/nagyv/gitlab-blackbox ai/blackbox ai@2
       inputs:
         config_dir: ${CI_PROJECT_DIR}/blackbox ai-config
         auth_json: $BLACKBOX_AI_AUTH_JSON # The variable name for your Blackbox AI authentication JSON
         command: optional-custom-command
         message: "Your prompt here"
   ```

Дополнительные сведения и варианты использования см. в документации ](https://gitlab.com/explore/catalog/nagyv/gitlab-blackbox ai) для этого компонента.

---

## GitLab Duo

blackbox ai интегрируется с вашим рабочим процессом GitLab.
Упомяните `@blackbox ai` в комментарии, и blackbox ai выполнит задачи в вашем конвейере GitLab CI.

---

### Функции

- **Триаж задач (Issue Triage)**. Попросите blackbox ai разобраться в проблеме и объяснить ее вам.
- **Исправление и реализация**. Попросите blackbox ai исправить проблему или реализовать функцию.
  Он создаст новую ветку и создаст мерж-реквест с изменениями.
- **Безопасность**: blackbox ai работает на ваших программах GitLab.

---

### Настройка

blackbox ai работает в вашем конвейере GitLab CI/CD. Вот что вам понадобится для его настройки:

:::tip
Ознакомьтесь с [**документацией GitLab**](https://docs.gitlab.com/user/duo_agent_platform/agent_assistant/) для получения актуальных инструкций.
:::

1.  Настройте свою среду GitLab
2.  Настройка CI/CD
3.  Получите ключ API поставщика моделей ИИ
4.  Создать учетную запись службы
5.  Настройка переменных CI/CD
6.  Создайте файл конфигурации потока, вот пример:

        <details>

    <summary>Конфигурация потока</summary>

    ```yaml
    image: node:22-slim
    commands:
      - echo "Installing blackbox ai"
      - npm install --global blackbox ai-ai
      - echo "Installing glab"
      - export GITLAB_TOKEN=$GITLAB_TOKEN_BLACKBOX_AI
      - apt-get update --quiet && apt-get install --yes curl wget gpg git && rm --recursive --force /var/lib/apt/lists/*
      - curl --silent --show-error --location "https://raw.githubusercontent.com/upciti/wakemeops/main/assets/install_repository" | bash
      - apt-get install --yes glab
      - echo "Configuring glab"
      - echo $GITLAB_HOST
      - echo "Creating Blackbox AI auth configuration"
      - mkdir --parents ~/.local/share/blackbox ai
      - |
        cat > ~/.local/share/blackbox ai/auth.json << EOF
        {
          "anthropic": {
            "type": "api",
            "key": "$ANTHROPIC_API_KEY"
          }
        }
        EOF
      - echo "Configuring git"
      - git config --global user.email "blackbox ai@gitlab.com"
      - git config --global user.name "Blackbox AI"
      - echo "Testing glab"
      - glab issue list
      - echo "Running Blackbox AI"
      - |
        blackbox ai run "
        You are an AI assistant helping with GitLab operations.

        Context: $AI_FLOW_CONTEXT
        Task: $AI_FLOW_INPUT
        Event: $AI_FLOW_EVENT

        Please execute the requested task using the available GitLab tools.
        Be thorough in your analysis and provide clear explanations.

        <important>
        Please use the glab CLI to access data from GitLab. The glab CLI has already been authenticated. You can run the corresponding commands.

        If you are asked to summarize an MR or issue or asked to provide more information then please post back a note to the MR/Issue so that the user can see it.
        You don't need to commit or push up changes, those will be done automatically based on the file changes you make.
        </important>
        "
      - git checkout --branch $CI_WORKLOAD_REF origin/$CI_WORKLOAD_REF
      - echo "Checking for git changes and pushing if any exist"
      - |
        if ! git diff --quiet || ! git diff --cached --quiet || [ --not --zero "$(git ls-files --others --exclude-standard)" ]; then
          echo "Git changes detected, adding and pushing..."
          git add .
          if git diff --cached --quiet; then
            echo "No staged changes to commit"
          else
            echo "Committing changes to branch: $CI_WORKLOAD_REF"
            git commit --message "Codex changes"
            echo "Pushing changes up to $CI_WORKLOAD_REF"
            git push https://gitlab-ci-token:$GITLAB_TOKEN@$GITLAB_HOST/gl-demo-ultimate-dev-ai-epic-17570/test-java-project.git $CI_WORKLOAD_REF
            echo "Changes successfully pushed"
          fi
        else
          echo "No git changes detected, skipping push"
        fi
    variables:
      - ANTHROPIC_API_KEY
      - GITLAB_TOKEN_BLACKBOX_AI
      - GITLAB_HOST
    ```

        </details>

Подробные инструкции можно найти в [GitLab CLI agents docs](https://docs.gitlab.com/user/duo_agent_platform/agent_assistant/).

---

### Примеры

Вот несколько примеров того, как вы можете использовать blackbox ai в GitLab.

:::tip
Вы можете настроить использование триггерной фразы, отличной от `@blackbox ai`.
:::

- **Объяснение проблемы**

  Добавьте этот комментарий в issue GitLab.

  ```
  @blackbox ai explain this issue
  ```

  blackbox ai прочитает проблему и ответит с четким объяснением.

- **Исправление проблемы**

  В issue GitLab напишите:

  ```
  @blackbox ai fix this
  ```

  blackbox ai создаст новую ветку, внедрит изменения и откроет мерж-реквест с изменениями.

- **Проверка Merge Request**

  Оставьте следующий комментарий к мерж-реквесту GitLab.

  ```
  @blackbox ai review this merge request
  ```

  blackbox ai рассмотрит мерж-реквест и предоставит отзыв.
